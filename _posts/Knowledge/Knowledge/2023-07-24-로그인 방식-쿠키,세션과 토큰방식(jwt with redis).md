---
title: "로그인 방식-쿠키,세션과 토큰방식(jwt with redis)"
categories : [Knowledge]
tag : [spring, 스프링, 스프링부트, 로그인, cookie, session, token, jwt, redis]
toc: true
toc_sticky: true
author_profile: false
sidebar:
  nav: "docs"
typora-root-url: ../../..
---



# Intro

**스프링으로 로그인 기능을 구현하는 중에, 인증 방식을 쿠키-세션 방식과 토큰 방식을 둘 다 구현해보면서 느낀 점을 간단하게 정리해두려 한다.**

<br><br>

# 쿠키-세션 방식 vs 토큰 방식(jwt with redis)

* [JWT 정리 추천 문서](https://www.popit.kr/jwt-%EC%9D%B8%EC%A6%9D%EC%9D%80-%EB%AC%B4%EC%97%87%EC%9D%B4%EA%B3%A0-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC-%ED%95%A0%EA%B9%8C/)

<br>

**`세션 쿠키 로그인 방식`의 경우에는 서버에서 세션을 서버 메모리에 기록해둠으로써 서버에 부하가 가는 반면,   
`JWT인증 토큰(JSON) 방식`의 경우에는 JWT 자체를 디코딩하면 사용자 ID 같은 인증 정보들을 구할 수 있기 때문에 따로 세션을 서버 메모리에 기록할 필요가 없어서 서버에 부하를 줄일 수가 있다.**

**단, `JWT 방식`은 로그아웃 시 강제로 토큰 만료를 시킬 수 없는 단점이 있고 반면에   
`세션 쿠키 방식`의 경우 서버 메모리의 세션을 제거하면 되기 때문에 쉽게 가능하다는 장점이 있다.**

**하지만 `JWT의 방식`에서 로그아웃을 아예 못 하는 것은 아니고 블랙리스트라는 기법을 활용해서 해결할 수 있다.**

* 안 쓰는 토큰 = 블랙리스트
* 따라서 로그아웃 API로 들어온 토큰을 블랙리스트로 DB나 메모리에 기록해두면 된다!!
* 단, 평생 기록할 필요가 없으니까 메모리에 기록하는 **Redis** 같은 저장소를 권장!
  * **Redis**란 In-Memory 구조이며, 오픈소스의 NoSQL DBMS이다.
  * 여기서 좋은 점은 In-Memory 방식인데 영속성을 보장해준다는 점이다.
  * 메모리를 사용하지만 영속성을 보장하기 위해 디스크의 일부를 **Redis**가 사용해서 AOF나 RDB 방식으로 기록해둔다.

<br><br>

# 그럼 언제 사용할까?

**언제 사용할지는 상황에 따라 다르다.   
다만, 깊게 생각하지 말고 간단하게만 판단하자면 웹에는 쿠키-세션 방식을 추천하고, 앱에는 JWT(토큰) 방식을 추천한다.**

**왜냐하면 `웹`은 기본적으로 stateless이다 보니 서버에서 관리(서버 메모리에 세션 저장)해주는 것이 좋고,  
`앱`은 웹앱이 아닌 네이티브 앱의 경우 stateful이다 보니 앱단에서 관리(토큰을 따로 저장 등등)해주는 것이 더 좋다.**

**물론, 이것이 정답은 아니고 큰 틀에서 보면 이렇게 나눠볼 수 있다는 것이다.**

<br>

**분명한 건 `앱`에서도 당연히 쿠키-세션 방식을 사용할 수 있다.**

**`웹`의 경우 통신 시 자동으로 웹브라우저가 쿠키를 요청 헤더에 포함해주는데,  
`앱`의 경우 웹브라우저를 가지고 있는 게 아니다 보니 HTTP라이브러리가 이를 해결한다.**

* 예로 HTTP라이브러리의 axios를 사용한다면, 일반 웹에서 HTTP통신하는 것처럼 자동으로 
  요청 헤더에 쿠키를 포함해준다. 
* 즉, 이 라이브러리를 사용하면 시스템 브라우저가 처리하는 방식과 유사하게 처리를 해준다는 것이다.

